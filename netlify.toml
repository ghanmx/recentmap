# Main build settings
[build]
  base = "."
  publish = "dist"  # Aseg√∫rate de que este sea el directorio correcto de salida
  command = "npm run build"

# Plugins
[[plugins]]
  package = "@netlify/plugin-lighthouse"

# Production context settings
[context.production]
  publish = "dist/"
  command = "npm run build"  # Comando actualizado
  environment = { NODE_VERSION = "14.15.3" }

# Deploy Preview settings
[context.deploy-preview]
  publish = "dist/"

[context.deploy-preview.environment]
  NOT_PRIVATE_ITEM = "not so secret"

# Branch Deploy settings
[context.branch-deploy]
  command = "npm run build"  # Comando consistente
  environment = { NODE_ENV = "development" }

# Development environment
[context.dev.environment]
  NODE_ENV = "development"

# Staging context settings
[context.staging]
  command = "npm run build"
  base = "staging"

# Specific branch context
[context."feat/branch"]
  command = "npm run build"
  base = "branch"

# Redirects configuration
[[redirects]]
  from = "/*"
  to = "/blog/:splat"
  status = 200

[[redirects]]
  from = "/old-path"
  to = "/new-path"
  status = 302
  force = true
  query = { id = ":id" }
  conditions = { Language = ["en"], Country = ["US"] }
  signed = "API_SIGNATURE_TOKEN"

  [redirects.headers]
    X-From = "Netlify"
    X-Api-Key = "some-api-key-string"

[[redirects]]
  from = "/gated-path"
  to = "/admin"  # Actualiza con la ruta deseada para acceso restringido
  status = 200
  conditions = { Role = ["admin"] }
  force = true

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers configuration
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    Content-Security-Policy = "frame-ancestors https://www.facebook.com"
    cache-control = "max-age=0, no-cache, no-store, must-revalidate"
    Basic-Auth = "someuser:somepassword anotheruser:anotherpassword"

# Functions directory
[functions]
  directory = "functions/"

# Local development server configuration
[dev]
  command = "yarn start"
  port = 8888
  publish = "dist"
